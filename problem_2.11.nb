(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     51277,       1355]
NotebookOptionsPosition[     47067,       1281]
NotebookOutlinePosition[     47460,       1297]
CellTagsIndexPosition[     47417,       1294]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Stationary version", "Section",ExpressionUUID->"c9e0f858-9e21-483d-942c-06f89e2026be"],

Cell[BoxData[
 RowBox[{"<<", "CompiledFunctionTools`"}]], "Input",
 CellLabel->"In[1]:=",ExpressionUUID->"0a6ef67c-fb35-4fd3-b9dd-75fb623aed0e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MainEvaluateFreeQ", "[", "f_CompiledFunction", "]"}], ":=", 
  RowBox[{
   RowBox[{"CompilePrint", "@", "f"}], "//", 
   RowBox[{"StringFreeQ", "[", "\"\<MainEvaluate\>\"", "]"}]}]}]], "Input",
 CellLabel->"In[2]:=",ExpressionUUID->"b39e00cf-03c5-4209-804b-bafd2c1bc9e5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetOptions", "[", 
   RowBox[{"Compile", ",", 
    RowBox[{"CompilationOptions", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"\"\<InlineExternalDefinitions\>\"", "\[Rule]", "True"}], 
      "}"}]}], ",", 
    RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}]}], "]"}], 
  ";"}]], "Input",
 CellLabel->"In[3]:=",ExpressionUUID->"0fe2bd76-0a7b-40b9-b616-447c2496e407"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"L", "=", "10"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"qs", "=", 
  RowBox[{"RandomVariate", "[", 
   RowBox[{
    RowBox[{"NormalDistribution", "[", 
     RowBox[{"0", ",", "1"}], "]"}], ",", "L"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"GreedyPolicyOpt", "[", "\[Epsilon]_", "]"}], ":=", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       FractionBox["\[Epsilon]", "L"], ",", "L"}], "]"}], "+", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"1", "-", "\[Epsilon]"}], ")"}], 
      RowBox[{"UnitVector", "[", 
       RowBox[{"L", ",", 
        RowBox[{"First", "[", 
         RowBox[{"Ordering", "[", 
          RowBox[{"qs", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], "]"}]}]}], ")"}], ".", 
   "qs"}]}]}], "Input",
 CellLabel->"In[4]:=",ExpressionUUID->"d4b439d1-3025-445a-b813-70c3a1a31fac"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Bandit", " ", "with", " ", "sample"}], "-", 
    RowBox[{"average", " ", "estimates", " ", "for", " ", "action"}], "-", 
    RowBox[{"values", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"SampleAverageBandit", "=", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[Epsilon]", ",", "_Real"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"L", ",", "_Integer"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"T", ",", "_Integer"}], "}"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "R", ",", "A", ",", "Q", ",", "M", ",", "t", ",", "action", ",", 
          "reward"}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"R", "=", 
          RowBox[{"Table", "[", 
           RowBox[{"0.0", ",", 
            RowBox[{"{", "T", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"A", "=", 
          RowBox[{"Range", "[", "L", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Q", "=", 
          RowBox[{"Table", "[", 
           RowBox[{"0.0", ",", 
            RowBox[{"{", "L", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"M", "=", 
          RowBox[{"Table", "[", 
           RowBox[{"0", ",", 
            RowBox[{"{", "L", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"t", "=", "1"}], ",", 
           RowBox[{"t", "\[LessEqual]", "T"}], ",", 
           RowBox[{"t", "+=", "1"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"action", "=", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"RandomReal", "[", "]"}], "<", 
                RowBox[{"1", "-", "\[Epsilon]"}]}], ",", 
               RowBox[{"A", "\[LeftDoubleBracket]", 
                RowBox[{"First", "@", 
                 RowBox[{"Ordering", "[", 
                  RowBox[{"Q", ",", 
                   RowBox[{"-", "1"}]}], "]"}]}], "\[RightDoubleBracket]"}], 
               ",", 
               RowBox[{"RandomChoice", "[", "A", "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"reward", "=", 
             RowBox[{"RandomVariate", "[", 
              RowBox[{"NormalDistribution", "[", 
               RowBox[{
                RowBox[{
                "qs", "\[LeftDoubleBracket]", "action", 
                 "\[RightDoubleBracket]"}], ",", "1"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
             "M", "\[LeftDoubleBracket]", "action", "\[RightDoubleBracket]"}],
              "+=", "1"}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
             "Q", "\[LeftDoubleBracket]", "action", "\[RightDoubleBracket]"}],
              "+=", 
             RowBox[{
              FractionBox["1", 
               RowBox[{
               "M", "\[LeftDoubleBracket]", "action", 
                "\[RightDoubleBracket]"}]], 
              RowBox[{"(", 
               RowBox[{"reward", "-", 
                RowBox[{
                "Q", "\[LeftDoubleBracket]", "action", 
                 "\[RightDoubleBracket]"}]}], ")"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
             "R", "\[LeftDoubleBracket]", "t", "\[RightDoubleBracket]"}], "=",
              "reward"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
         "\[IndentingNewLine]", "R"}]}], "\[IndentingNewLine]", "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
   "MainEvaluateFreeQ", "[", "SampleAverageBandit", "]"}]}]}]], "Input",
 CellLabel->"In[7]:=",ExpressionUUID->"ef9285c8-f0fe-4084-8436-be5ef5b5db9a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "Bandit", " ", "with", " ", "fixed", " ", "step", " ", "sizes", " ", "in",
      " ", "action"}], "-", 
    RowBox[{"value", " ", 
     RowBox[{"estimates", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"FixedStepBandit", "=", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[Epsilon]", ",", "_Real"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"L", ",", "_Integer"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"\[Alpha]", ",", "_Real"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Q0", ",", "_Real"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"T", ",", "_Integer"}], "}"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "R", ",", "A", ",", "Q", ",", "t", ",", "action", ",", "reward"}], 
         "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"R", "=", 
          RowBox[{"Table", "[", 
           RowBox[{"0.0", ",", 
            RowBox[{"{", "T", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"A", "=", 
          RowBox[{"Range", "[", "L", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Q", "=", 
          RowBox[{"Table", "[", 
           RowBox[{"Q0", ",", 
            RowBox[{"{", "L", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"t", "=", "1"}], ",", 
           RowBox[{"t", "\[LessEqual]", "T"}], ",", 
           RowBox[{"t", "+=", "1"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"action", "=", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"RandomReal", "[", "]"}], "<", 
                RowBox[{"1", "-", "\[Epsilon]"}]}], ",", 
               RowBox[{"A", "\[LeftDoubleBracket]", 
                RowBox[{"First", "@", 
                 RowBox[{"Ordering", "[", 
                  RowBox[{"Q", ",", 
                   RowBox[{"-", "1"}]}], "]"}]}], "\[RightDoubleBracket]"}], 
               ",", 
               RowBox[{"RandomChoice", "[", "A", "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"reward", "=", 
             RowBox[{"RandomVariate", "[", 
              RowBox[{"NormalDistribution", "[", 
               RowBox[{
                RowBox[{
                "qs", "\[LeftDoubleBracket]", "action", 
                 "\[RightDoubleBracket]"}], ",", "1"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
             "Q", "\[LeftDoubleBracket]", "action", "\[RightDoubleBracket]"}],
              "+=", 
             RowBox[{"\[Alpha]", 
              RowBox[{"(", 
               RowBox[{"reward", "-", 
                RowBox[{
                "Q", "\[LeftDoubleBracket]", "action", 
                 "\[RightDoubleBracket]"}]}], ")"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
             "R", "\[LeftDoubleBracket]", "t", "\[RightDoubleBracket]"}], "=",
              "reward"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
         "\[IndentingNewLine]", "R"}]}], "\[IndentingNewLine]", "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"MainEvaluateFreeQ", "[", "FixedStepBandit", "]"}]}]}]], "Input",
 CellLabel->"In[9]:=",ExpressionUUID->"9f8ccbf2-1054-436d-88e1-6e25dcc84f26"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Softmax", "=", 
   RowBox[{"Function", "[", 
    RowBox[{"x", ",", 
     FractionBox[
      RowBox[{"Exp", "@", "x"}], 
      RowBox[{"Total", "@", 
       RowBox[{"Exp", "@", "x"}]}]]}], "]"}]}], ";"}], "\[IndentingNewLine]", 

 RowBox[{
  RowBox[{
   RowBox[{"RUnitVector", "=", 
    RowBox[{"Function", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"L", ",", "i"}], "}"}], ",", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"i", "\[Equal]", "j"}], ",", "1.0", ",", "0.0"}], "]"}], 
        ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "L"}], "}"}]}], "]"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Bandit", " ", "with", " ", "gradient", " ", "based", " ", "action", " ", 
    "preference", " ", 
    RowBox[{"updates", "."}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"GradientBandit", "=", 
  RowBox[{"Compile", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"L", ",", "_Integer"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"\[Alpha]", ",", "_Real"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"T", ",", "_Integer"}], "}"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "R", ",", "A", ",", "H", ",", "\[Pi]t", ",", "totalReward", ",", 
        "baseline", ",", "t", ",", "action", ",", "reward"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"R", "=", 
        RowBox[{"Table", "[", 
         RowBox[{"0.0", ",", 
          RowBox[{"{", "T", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"A", "=", 
        RowBox[{"Range", "[", "L", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"H", "=", 
        RowBox[{"Table", "[", 
         RowBox[{"0.0", ",", 
          RowBox[{"{", "L", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"\[Pi]t", "=", 
        RowBox[{"Softmax", "[", "H", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"totalReward", "=", "0.0"}], ";", "\[IndentingNewLine]", 
       RowBox[{"baseline", "=", "0.0"}], ";", "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"t", "=", "1"}], ",", 
         RowBox[{"t", "\[LessEqual]", "T"}], ",", 
         RowBox[{"t", "+=", "1"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"action", "=", 
           RowBox[{"RandomChoice", "[", 
            RowBox[{"\[Pi]t", "\[Rule]", "A"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"reward", "=", 
           RowBox[{"RandomVariate", "[", 
            RowBox[{"NormalDistribution", "[", 
             RowBox[{
              RowBox[{
              "qs", "\[LeftDoubleBracket]", "action", 
               "\[RightDoubleBracket]"}], ",", "1"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"H", "+=", 
           RowBox[{"\[Alpha]", 
            RowBox[{"(", 
             RowBox[{"reward", "-", "baseline"}], ")"}], 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"RUnitVector", "[", 
               RowBox[{"L", ",", "action"}], "]"}], "-", "\[Pi]t"}], 
             ")"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"\[Pi]t", "=", 
           RowBox[{"Softmax", "[", "H", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "R", "\[LeftDoubleBracket]", "t", "\[RightDoubleBracket]"}], "=", 
           "reward"}], ";", "\[IndentingNewLine]", 
          RowBox[{"totalReward", "+=", "reward"}], ";", "\[IndentingNewLine]", 
          RowBox[{"baseline", "=", 
           RowBox[{"totalReward", "/", "t"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "R"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"MainEvaluateFreeQ", "[", "GradientBandit", "]"}]}], "Input",
 CellLabel->"In[11]:=",ExpressionUUID->"cc03f918-925f-44d8-ac27-e2bd2db64ae1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Bandit", " ", "with", " ", "upper"}], "-", "confidence", "-", 
    RowBox[{"bound", " ", "action", " ", 
     RowBox[{"selection", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"UCBBandit", "=", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"L", ",", "_Integer"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"c", ",", "_Real"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"T", ",", "_Integer"}], "}"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "R", ",", "A", ",", "Q", ",", "M", ",", "t", ",", "action", ",", 
          "reward"}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"R", "=", 
          RowBox[{"Table", "[", 
           RowBox[{"0.0", ",", 
            RowBox[{"{", "T", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"A", "=", 
          RowBox[{"Range", "[", "L", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Q", "=", 
          RowBox[{"Table", "[", 
           RowBox[{"0.0", ",", 
            RowBox[{"{", "L", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"M", "=", 
          RowBox[{"Table", "[", 
           RowBox[{"0", ",", 
            RowBox[{"{", "L", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"t", "=", "1"}], ",", 
           RowBox[{"t", "\[LessEqual]", "T"}], ",", 
           RowBox[{"t", "+=", "1"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"action", "=", 
             RowBox[{"First", "@", 
              RowBox[{"Ordering", "[", 
               RowBox[{
                RowBox[{"Q", "+", 
                 RowBox[{"c", 
                  SqrtBox[
                   FractionBox[
                    RowBox[{"Log", "[", "t", "]"}], 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Max", "[", 
                    RowBox[{"#", ",", 
                    SuperscriptBox["10", 
                    RowBox[{"-", "10"}]]}], "]"}], "&"}], "/@", "M"}]]]}]}], 
                ",", 
                RowBox[{"-", "1"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"reward", "=", 
             RowBox[{"RandomVariate", "[", 
              RowBox[{"NormalDistribution", "[", 
               RowBox[{
                RowBox[{
                "qs", "\[LeftDoubleBracket]", "action", 
                 "\[RightDoubleBracket]"}], ",", "1"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
             "M", "\[LeftDoubleBracket]", "action", "\[RightDoubleBracket]"}],
              "+=", "1"}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
             "Q", "\[LeftDoubleBracket]", "action", "\[RightDoubleBracket]"}],
              "+=", 
             RowBox[{
              FractionBox["1", 
               RowBox[{
               "M", "\[LeftDoubleBracket]", "action", 
                "\[RightDoubleBracket]"}]], 
              RowBox[{"(", 
               RowBox[{"reward", "-", 
                RowBox[{
                "Q", "\[LeftDoubleBracket]", "action", 
                 "\[RightDoubleBracket]"}]}], ")"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
             "R", "\[LeftDoubleBracket]", "t", "\[RightDoubleBracket]"}], "=",
              "reward"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
         "\[IndentingNewLine]", "R"}]}], "\[IndentingNewLine]", "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"MainEvaluateFreeQ", "[", "UCBBandit", "]"}]}]}]], "Input",
 CellLabel->"In[15]:=",ExpressionUUID->"48d6df21-6396-418a-b09d-92aaac805025"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"steps", "=", "200000"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"runs", "=", "10"}], ";"}]}], "Input",
 CellLabel->"In[17]:=",ExpressionUUID->"6af13940-b0a6-4936-8bf0-28b4d9740bc2"],

Cell[CellGroupData[{

Cell["Sample average", "Subsection",ExpressionUUID->"b9775285-c665-44a4-81e1-977877a19850"],

Cell[BoxData[
 RowBox[{"\[Epsilon]GreedyData", "=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"\[Epsilon]", ",", 
      RowBox[{"Mean", "@", 
       RowBox[{"Flatten", "@", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Take", "[", 
           RowBox[{
            RowBox[{"SampleAverageBandit", "[", 
             RowBox[{"\[Epsilon]", ",", "L", ",", "steps"}], "]"}], ",", 
            RowBox[{"-", 
             RowBox[{"Floor", "[", 
              RowBox[{"steps", "/", "2"}], "]"}]}]}], "]"}], ",", "runs"}], 
         "]"}]}]}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"\[Epsilon]", ",", 
      RowBox[{"Table", "[", 
       RowBox[{
        FractionBox["1", 
         SuperscriptBox["2", "i"]], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "2", ",", "7"}], "}"}]}], "]"}]}], "}"}]}], 
   "]"}]}]], "Input",
 CellLabel->"In[19]:=",ExpressionUUID->"daa206ef-25a2-46ac-beab-7d86b0c1ef90"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Fixed step", "Subsection",ExpressionUUID->"a05a0e13-c90d-480e-9b93-a46ea8101056"],

Cell[BoxData[
 RowBox[{"fixedStepGreedyData", "=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"Q0", ",", 
      RowBox[{"Mean", "@", 
       RowBox[{"Flatten", "@", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Take", "[", 
           RowBox[{
            RowBox[{"FixedStepBandit", "[", 
             RowBox[{"0.0", ",", "L", ",", "0.1", ",", "Q0", ",", "steps"}], 
             "]"}], ",", 
            RowBox[{"-", 
             RowBox[{"Floor", "[", 
              RowBox[{"steps", "/", "2"}], "]"}]}]}], "]"}], ",", "runs"}], 
         "]"}]}]}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"Q0", ",", 
      RowBox[{"Table", "[", 
       RowBox[{
        FractionBox["1", 
         SuperscriptBox["2", "i"]], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"-", "2"}], ",", "2"}], "}"}]}], "]"}]}], "}"}]}], 
   "]"}]}]], "Input",
 CellLabel->"In[20]:=",ExpressionUUID->"a5f123ff-c9e6-4486-84bc-631bd5f8800c"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Gradient", "Subsection",ExpressionUUID->"e6df1fcf-a2fb-48a4-8ce8-ae02881bcbcd"],

Cell[BoxData[
 RowBox[{"gradientData", "=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"\[Alpha]", ",", 
      RowBox[{"Mean", "@", 
       RowBox[{"Flatten", "@", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Take", "[", 
           RowBox[{
            RowBox[{"GradientBandit", "[", 
             RowBox[{"L", ",", "\[Alpha]", ",", "steps"}], "]"}], ",", 
            RowBox[{"-", 
             RowBox[{"Floor", "[", 
              RowBox[{"steps", "/", "2"}], "]"}]}]}], "]"}], ",", "runs"}], 
         "]"}]}]}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"\[Alpha]", ",", 
      RowBox[{"Table", "[", 
       RowBox[{
        FractionBox["1", 
         SuperscriptBox["2", "i"]], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"-", "2"}], ",", "5"}], "}"}]}], "]"}]}], "}"}]}], 
   "]"}]}]], "Input",
 CellLabel->"In[21]:=",ExpressionUUID->"d4ff27a7-a8d5-45b7-aec7-03e6670166f2"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Upper confidence bound", "Subsection",ExpressionUUID->"bf99d4e9-49e3-4c61-b27f-f5a161401b96"],

Cell[BoxData[
 RowBox[{"ucbData", "=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"c", ",", 
      RowBox[{"Mean", "@", 
       RowBox[{"Flatten", "@", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Take", "[", 
           RowBox[{
            RowBox[{"UCBBandit", "[", 
             RowBox[{"L", ",", "c", ",", "steps"}], "]"}], ",", 
            RowBox[{"-", 
             RowBox[{"Floor", "[", 
              RowBox[{"steps", "/", "2"}], "]"}]}]}], "]"}], ",", "runs"}], 
         "]"}]}]}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"c", ",", 
      RowBox[{"Table", "[", 
       RowBox[{
        FractionBox["1", 
         SuperscriptBox["2", "i"]], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"-", "2"}], ",", "4"}], "}"}]}], "]"}]}], "}"}]}], 
   "]"}]}]], "Input",
 CellLabel->"In[22]:=",ExpressionUUID->"5cd65691-b708-4091-b190-fc374cae2bdc"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Results", "Subsection",ExpressionUUID->"135fbf05-4a32-4138-ad65-a115c57be413"],

Cell[BoxData[
 RowBox[{"ListLogLinearPlot", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "\[Epsilon]GreedyData", ",", "fixedStepGreedyData", ",", "gradientData", 
     ",", "ucbData"}], "}"}], ",", 
   RowBox[{"PlotStyle", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"Red", ",", "Black", ",", "Green", ",", "Blue"}], "}"}]}], ",", 
   RowBox[{"Ticks", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Table", "[", 
       RowBox[{
        FractionBox["1", 
         SuperscriptBox["2", ""]], ",", 
        RowBox[{"{", 
         RowBox[{",", 
          RowBox[{"-", "2"}], ",", "7"}], "}"}]}], "]"}], ",", "Automatic"}], 
     "}"}]}], ",", 
   RowBox[{"PlotLegends", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
     "\"\<\[Epsilon]-greedy (\[Epsilon])\>\"", ",", 
      "\"\<greedy w/ opt. init (\!\(\*SubscriptBox[\(Q\), \(0\)]\))\>\"", 
      ",", "\"\<gradient (\[Alpha])\>\"", ",", "\"\<UCB (c)\>\""}], "}"}]}], 
   ",", 
   RowBox[{"AxesLabel", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{",", "\"\<avg reward\>\""}], "}"}]}]}], "]"}]], "Input",
 CellLabel->"In[23]:=",ExpressionUUID->"33f20699-f100-473c-9fda-32e6812ef8aa"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Non-stationary version", "Section",ExpressionUUID->"c72d01ec-8d97-4f81-889d-d6d6ad21a21c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Bandit", " ", "with", " ", "sample"}], "-", 
    RowBox[{"average", " ", "estimates", " ", "for", " ", "action"}], "-", 
    RowBox[{"values", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"SampleAverageBandit", "=", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[Epsilon]", ",", "_Real"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"L", ",", "_Integer"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"T", ",", "_Integer"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"randomWalk", ",", "_Real", ",", "2"}], "}"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "R", ",", "A", ",", "Q", ",", "M", ",", "t", ",", "action", ",", 
          "reward"}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"R", "=", 
          RowBox[{"Table", "[", 
           RowBox[{"0.0", ",", 
            RowBox[{"{", "T", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"A", "=", 
          RowBox[{"Range", "[", "L", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Q", "=", 
          RowBox[{"Table", "[", 
           RowBox[{"0.0", ",", 
            RowBox[{"{", "L", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"M", "=", 
          RowBox[{"Table", "[", 
           RowBox[{"0", ",", 
            RowBox[{"{", "L", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"t", "=", "1"}], ",", 
           RowBox[{"t", "\[LessEqual]", "T"}], ",", 
           RowBox[{"t", "+=", "1"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"action", "=", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"RandomReal", "[", "]"}], "<", 
                RowBox[{"1", "-", "\[Epsilon]"}]}], ",", 
               RowBox[{"A", "\[LeftDoubleBracket]", 
                RowBox[{"First", "@", 
                 RowBox[{"Ordering", "[", 
                  RowBox[{"Q", ",", 
                   RowBox[{"-", "1"}]}], "]"}]}], "\[RightDoubleBracket]"}], 
               ",", 
               RowBox[{"RandomChoice", "[", "A", "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"reward", "=", 
             RowBox[{"RandomVariate", "[", 
              RowBox[{"NormalDistribution", "[", 
               RowBox[{
                RowBox[{"randomWalk", "\[LeftDoubleBracket]", 
                 RowBox[{"action", ",", "t"}], "\[RightDoubleBracket]"}], ",",
                 "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
             "M", "\[LeftDoubleBracket]", "action", "\[RightDoubleBracket]"}],
              "+=", "1"}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
             "Q", "\[LeftDoubleBracket]", "action", "\[RightDoubleBracket]"}],
              "+=", 
             RowBox[{
              FractionBox["1", 
               RowBox[{
               "M", "\[LeftDoubleBracket]", "action", 
                "\[RightDoubleBracket]"}]], 
              RowBox[{"(", 
               RowBox[{"reward", "-", 
                RowBox[{
                "Q", "\[LeftDoubleBracket]", "action", 
                 "\[RightDoubleBracket]"}]}], ")"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
             "R", "\[LeftDoubleBracket]", "t", "\[RightDoubleBracket]"}], "=",
              "reward"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
         "\[IndentingNewLine]", "R"}]}], "\[IndentingNewLine]", "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
   "MainEvaluateFreeQ", "[", "SampleAverageBandit", "]"}]}]}]], "Input",
 CellLabel->"In[24]:=",ExpressionUUID->"b582dfcb-ab6f-4a80-8b7f-9e878c92b872"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "Bandit", " ", "with", " ", "fixed", " ", "step", " ", "sizes", " ", "in",
      " ", "action"}], "-", 
    RowBox[{"value", " ", 
     RowBox[{"estimates", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"FixedStepBandit", "=", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[Epsilon]", ",", "_Real"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"L", ",", "_Integer"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"\[Alpha]", ",", "_Real"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Q0", ",", "_Real"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"T", ",", "_Integer"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"randomWalk", ",", "_Real", ",", "2"}], "}"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "R", ",", "A", ",", "Q", ",", "t", ",", "action", ",", "reward"}], 
         "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"R", "=", 
          RowBox[{"Table", "[", 
           RowBox[{"0.0", ",", 
            RowBox[{"{", "T", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"A", "=", 
          RowBox[{"Range", "[", "L", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Q", "=", 
          RowBox[{"Table", "[", 
           RowBox[{"Q0", ",", 
            RowBox[{"{", "L", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"t", "=", "1"}], ",", 
           RowBox[{"t", "\[LessEqual]", "T"}], ",", 
           RowBox[{"t", "+=", "1"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"action", "=", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"RandomReal", "[", "]"}], "<", 
                RowBox[{"1", "-", "\[Epsilon]"}]}], ",", 
               RowBox[{"A", "\[LeftDoubleBracket]", 
                RowBox[{"First", "@", 
                 RowBox[{"Ordering", "[", 
                  RowBox[{"Q", ",", 
                   RowBox[{"-", "1"}]}], "]"}]}], "\[RightDoubleBracket]"}], 
               ",", 
               RowBox[{"RandomChoice", "[", "A", "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"reward", "=", 
             RowBox[{"RandomVariate", "[", 
              RowBox[{"NormalDistribution", "[", 
               RowBox[{
                RowBox[{"randomWalk", "\[LeftDoubleBracket]", 
                 RowBox[{"action", ",", "t"}], "\[RightDoubleBracket]"}], ",",
                 "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
             "Q", "\[LeftDoubleBracket]", "action", "\[RightDoubleBracket]"}],
              "+=", 
             RowBox[{"\[Alpha]", 
              RowBox[{"(", 
               RowBox[{"reward", "-", 
                RowBox[{
                "Q", "\[LeftDoubleBracket]", "action", 
                 "\[RightDoubleBracket]"}]}], ")"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
             "R", "\[LeftDoubleBracket]", "t", "\[RightDoubleBracket]"}], "=",
              "reward"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
         "\[IndentingNewLine]", "R"}]}], "\[IndentingNewLine]", "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"MainEvaluateFreeQ", "[", "FixedStepBandit", "]"}]}]}]], "Input",
 CellLabel->"In[26]:=",ExpressionUUID->"716c64a2-8855-4bbc-8dc6-e55938fe9d78"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Softmax", "=", 
   RowBox[{"Function", "[", 
    RowBox[{"x", ",", 
     FractionBox[
      RowBox[{"Exp", "@", "x"}], 
      RowBox[{"Total", "@", 
       RowBox[{"Exp", "@", "x"}]}]]}], "]"}]}], ";"}], "\[IndentingNewLine]", 

 RowBox[{
  RowBox[{
   RowBox[{"RUnitVector", "=", 
    RowBox[{"Function", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"L", ",", "i"}], "}"}], ",", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"i", "\[Equal]", "j"}], ",", "1.0", ",", "0.0"}], "]"}], 
        ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "L"}], "}"}]}], "]"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Bandit", " ", "with", " ", "gradient", " ", "based", " ", "action", " ", 
    "preference", " ", 
    RowBox[{"updates", "."}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"GradientBandit", "=", 
  RowBox[{"Compile", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"L", ",", "_Integer"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"\[Alpha]", ",", "_Real"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"T", ",", "_Integer"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"randomWalk", ",", "_Real", ",", "2"}], "}"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "R", ",", "A", ",", "H", ",", "\[Pi]t", ",", "totalReward", ",", 
        "baseline", ",", "t", ",", "action", ",", "reward"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"R", "=", 
        RowBox[{"Table", "[", 
         RowBox[{"0.0", ",", 
          RowBox[{"{", "T", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"A", "=", 
        RowBox[{"Range", "[", "L", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"H", "=", 
        RowBox[{"Table", "[", 
         RowBox[{"0.0", ",", 
          RowBox[{"{", "L", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"\[Pi]t", "=", 
        RowBox[{"Softmax", "[", "H", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"totalReward", "=", "0.0"}], ";", "\[IndentingNewLine]", 
       RowBox[{"baseline", "=", "0.0"}], ";", "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"t", "=", "1"}], ",", 
         RowBox[{"t", "\[LessEqual]", "T"}], ",", 
         RowBox[{"t", "+=", "1"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"action", "=", 
           RowBox[{"RandomChoice", "[", 
            RowBox[{"\[Pi]t", "\[Rule]", "A"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"reward", "=", 
           RowBox[{"RandomVariate", "[", 
            RowBox[{"NormalDistribution", "[", 
             RowBox[{
              RowBox[{"randomWalk", "\[LeftDoubleBracket]", 
               RowBox[{"action", ",", "t"}], "\[RightDoubleBracket]"}], ",", 
              "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"H", "+=", 
           RowBox[{"\[Alpha]", 
            RowBox[{"(", 
             RowBox[{"reward", "-", "baseline"}], ")"}], 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"RUnitVector", "[", 
               RowBox[{"L", ",", "action"}], "]"}], "-", "\[Pi]t"}], 
             ")"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"\[Pi]t", "=", 
           RowBox[{"Softmax", "[", "H", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "R", "\[LeftDoubleBracket]", "t", "\[RightDoubleBracket]"}], "=", 
           "reward"}], ";", "\[IndentingNewLine]", 
          RowBox[{"totalReward", "+=", "reward"}], ";", "\[IndentingNewLine]", 
          RowBox[{"baseline", "=", 
           RowBox[{"totalReward", "/", "t"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "R"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"MainEvaluateFreeQ", "[", "GradientBandit", "]"}]}], "Input",
 CellLabel->"In[28]:=",ExpressionUUID->"40ca40a5-af56-4cfa-afcc-dcd4df50cb3d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Bandit", " ", "with", " ", "upper"}], "-", "confidence", "-", 
    RowBox[{"bound", " ", "action", " ", 
     RowBox[{"selection", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"UCBBandit", "=", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"L", ",", "_Integer"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"c", ",", "_Real"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"T", ",", "_Integer"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"randomWalk", ",", "_Real", ",", "2"}], "}"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "R", ",", "A", ",", "Q", ",", "M", ",", "t", ",", "action", ",", 
          "reward"}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"R", "=", 
          RowBox[{"Table", "[", 
           RowBox[{"0.0", ",", 
            RowBox[{"{", "T", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"A", "=", 
          RowBox[{"Range", "[", "L", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Q", "=", 
          RowBox[{"Table", "[", 
           RowBox[{"0.0", ",", 
            RowBox[{"{", "L", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"M", "=", 
          RowBox[{"Table", "[", 
           RowBox[{"0", ",", 
            RowBox[{"{", "L", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"t", "=", "1"}], ",", 
           RowBox[{"t", "\[LessEqual]", "T"}], ",", 
           RowBox[{"t", "+=", "1"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"action", "=", 
             RowBox[{"First", "@", 
              RowBox[{"Ordering", "[", 
               RowBox[{
                RowBox[{"Q", "+", 
                 RowBox[{"c", 
                  SqrtBox[
                   FractionBox[
                    RowBox[{"Log", "[", "t", "]"}], 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Max", "[", 
                    RowBox[{"#", ",", 
                    SuperscriptBox["10", 
                    RowBox[{"-", "10"}]]}], "]"}], "&"}], "/@", "M"}]]]}]}], 
                ",", 
                RowBox[{"-", "1"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"reward", "=", 
             RowBox[{"RandomVariate", "[", 
              RowBox[{"NormalDistribution", "[", 
               RowBox[{
                RowBox[{"randomWalk", "\[LeftDoubleBracket]", 
                 RowBox[{"action", ",", "t"}], "\[RightDoubleBracket]"}], ",",
                 "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
             "M", "\[LeftDoubleBracket]", "action", "\[RightDoubleBracket]"}],
              "+=", "1"}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
             "Q", "\[LeftDoubleBracket]", "action", "\[RightDoubleBracket]"}],
              "+=", 
             RowBox[{
              FractionBox["1", 
               RowBox[{
               "M", "\[LeftDoubleBracket]", "action", 
                "\[RightDoubleBracket]"}]], 
              RowBox[{"(", 
               RowBox[{"reward", "-", 
                RowBox[{
                "Q", "\[LeftDoubleBracket]", "action", 
                 "\[RightDoubleBracket]"}]}], ")"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
             "R", "\[LeftDoubleBracket]", "t", "\[RightDoubleBracket]"}], "=",
              "reward"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
         "\[IndentingNewLine]", "R"}]}], "\[IndentingNewLine]", "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"MainEvaluateFreeQ", "[", "UCBBandit", "]"}]}]}]], "Input",
 CellLabel->"In[32]:=",ExpressionUUID->"7d3fac15-3fef-43f6-b1bc-08e589d4a907"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"steps", "=", "200000"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"runs", "=", "10"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"randomWalk", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"NestList", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "+", 
         RowBox[{"RandomVariate", "[", 
          RowBox[{"NormalDistribution", "[", 
           RowBox[{"0", ",", "0.01"}], "]"}], "]"}]}], "&"}], ",", "0", ",", 
       RowBox[{"steps", "-", "1"}]}], "]"}], ",", "L"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"randomWalk", "\[LeftDoubleBracket]", 
   RowBox[{";;", ",", 
    RowBox[{";;", ";;", 
     RowBox[{"Max", "[", 
      RowBox[{"1", ",", 
       RowBox[{"Floor", "[", 
        RowBox[{"steps", "/", "100"}], "]"}]}], "]"}]}]}], 
   "\[RightDoubleBracket]"}], "//", "ListLinePlot"}]}], "Input",
 CellLabel->"In[34]:=",ExpressionUUID->"aa791100-5a57-46a7-8cf5-bdf8c182b35b"],

Cell[CellGroupData[{

Cell["Sample average", "Subsection",ExpressionUUID->"aa9aebb4-9e16-4661-8b38-c3adf7a6fa92"],

Cell[BoxData[
 RowBox[{"\[Epsilon]GreedyData", "=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"\[Epsilon]", ",", 
      RowBox[{"Mean", "@", 
       RowBox[{"Flatten", "@", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Take", "[", 
           RowBox[{
            RowBox[{"SampleAverageBandit", "[", 
             RowBox[{
             "\[Epsilon]", ",", "L", ",", "steps", ",", "randomWalk"}], "]"}],
             ",", 
            RowBox[{"-", 
             RowBox[{"Floor", "[", 
              RowBox[{"steps", "/", "2"}], "]"}]}]}], "]"}], ",", "runs"}], 
         "]"}]}]}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"\[Epsilon]", ",", 
      RowBox[{"Table", "[", 
       RowBox[{
        FractionBox["1", 
         SuperscriptBox["2", "i"]], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "2", ",", "7"}], "}"}]}], "]"}]}], "}"}]}], 
   "]"}]}]], "Input",
 CellLabel->"In[38]:=",ExpressionUUID->"24ab5b96-9475-4e14-985e-e18d9f3938bd"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Fixed step", "Subsection",ExpressionUUID->"1d4992d6-2e37-48ae-9485-7703725dae9e"],

Cell[BoxData[
 RowBox[{"fixedStepGreedyData", "=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"Q0", ",", 
      RowBox[{"Mean", "@", 
       RowBox[{"Flatten", "@", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Take", "[", 
           RowBox[{
            RowBox[{"FixedStepBandit", "[", 
             RowBox[{
             "0.0", ",", "L", ",", "0.1", ",", "Q0", ",", "steps", ",", 
              "randomWalk"}], "]"}], ",", 
            RowBox[{"-", 
             RowBox[{"Floor", "[", 
              RowBox[{"steps", "/", "2"}], "]"}]}]}], "]"}], ",", "runs"}], 
         "]"}]}]}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"Q0", ",", 
      RowBox[{"Table", "[", 
       RowBox[{
        FractionBox["1", 
         SuperscriptBox["2", "i"]], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"-", "2"}], ",", "2"}], "}"}]}], "]"}]}], "}"}]}], 
   "]"}]}]], "Input",
 CellLabel->"In[39]:=",ExpressionUUID->"6ba67188-8879-44c6-a32e-bd7907ac768f"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Gradient", "Subsection",ExpressionUUID->"d7069e78-421c-4109-8830-e4f74b32eb6c"],

Cell[BoxData[
 RowBox[{"gradientData", "=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"\[Alpha]", ",", 
      RowBox[{"Mean", "@", 
       RowBox[{"Flatten", "@", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Take", "[", 
           RowBox[{
            RowBox[{"GradientBandit", "[", 
             RowBox[{"L", ",", "\[Alpha]", ",", "steps", ",", "randomWalk"}], 
             "]"}], ",", 
            RowBox[{"-", 
             RowBox[{"Floor", "[", 
              RowBox[{"steps", "/", "2"}], "]"}]}]}], "]"}], ",", "runs"}], 
         "]"}]}]}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"\[Alpha]", ",", 
      RowBox[{"Table", "[", 
       RowBox[{
        FractionBox["1", 
         SuperscriptBox["2", "i"]], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"-", "2"}], ",", "5"}], "}"}]}], "]"}]}], "}"}]}], 
   "]"}]}]], "Input",
 CellLabel->"In[40]:=",ExpressionUUID->"4e144856-a1e8-48f2-b5a4-feb44f52b242"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Upper confidence bound", "Subsection",ExpressionUUID->"6959d6de-1f79-4253-b803-c28e73d6b735"],

Cell[BoxData[
 RowBox[{"ucbData", "=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"c", ",", 
      RowBox[{"Mean", "@", 
       RowBox[{"Flatten", "@", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Take", "[", 
           RowBox[{
            RowBox[{"UCBBandit", "[", 
             RowBox[{"L", ",", "c", ",", "steps", ",", "randomWalk"}], "]"}], 
            ",", 
            RowBox[{"-", 
             RowBox[{"Floor", "[", 
              RowBox[{"steps", "/", "2"}], "]"}]}]}], "]"}], ",", "runs"}], 
         "]"}]}]}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"c", ",", 
      RowBox[{"Table", "[", 
       RowBox[{
        FractionBox["1", 
         SuperscriptBox["2", "i"]], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"-", "2"}], ",", "4"}], "}"}]}], "]"}]}], "}"}]}], 
   "]"}]}]], "Input",
 CellLabel->"In[41]:=",ExpressionUUID->"cc8ec308-3d27-4d32-b8fc-200974cb0cf3"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Results", "Subsection",ExpressionUUID->"f51f61b4-155a-4e2f-a231-18bfab7bb178"],

Cell[BoxData[
 RowBox[{"ListLogLinearPlot", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "\[Epsilon]GreedyData", ",", "fixedStepGreedyData", ",", "gradientData", 
     ",", "ucbData"}], "}"}], ",", 
   RowBox[{"PlotStyle", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"Red", ",", "Black", ",", "Green", ",", "Blue"}], "}"}]}], ",", 
   RowBox[{"Ticks", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Table", "[", 
       RowBox[{
        FractionBox["1", 
         SuperscriptBox["2", ""]], ",", 
        RowBox[{"{", 
         RowBox[{",", 
          RowBox[{"-", "2"}], ",", "7"}], "}"}]}], "]"}], ",", "Automatic"}], 
     "}"}]}], ",", 
   RowBox[{"PlotLegends", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
     "\"\<\[Epsilon]-greedy (\[Epsilon])\>\"", ",", 
      "\"\<greedy w/ opt. init (\!\(\*SubscriptBox[\(Q\), \(0\)]\))\>\"", 
      ",", "\"\<gradient (\[Alpha])\>\"", ",", "\"\<UCB (c)\>\""}], "}"}]}], 
   ",", 
   RowBox[{"AxesLabel", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{",", "\"\<avg reward\>\""}], "}"}]}]}], "]"}]], "Input",
 CellLabel->"In[42]:=",ExpressionUUID->"fabb2ee1-1437-49bc-a1b5-c7bddef54cdd"],

Cell["\<\
The performance of all algorithms is clearly worse (as a percentage of \
optimal average reward) than in the stationary case.\
\>", "Text",ExpressionUUID->"85e35ab9-5a17-43d4-8934-52f1354ad800"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1275, 1208},
WindowMargins->{{Automatic, 18}, {18, Automatic}},
FrontEndVersion->"12.1 for Linux x86 (64-bit) (March 14, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"4443836b-18cd-439b-8662-844850d091b3"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 92, 0, 67, "Section",ExpressionUUID->"c9e0f858-9e21-483d-942c-06f89e2026be"],
Cell[675, 24, 144, 2, 30, "Input",ExpressionUUID->"0a6ef67c-fb35-4fd3-b9dd-75fb623aed0e"],
Cell[822, 28, 306, 6, 30, "Input",ExpressionUUID->"b39e00cf-03c5-4209-804b-bafd2c1bc9e5"],
Cell[1131, 36, 406, 10, 30, "Input",ExpressionUUID->"0fe2bd76-0a7b-40b9-b616-447c2496e407"],
Cell[1540, 48, 910, 27, 87, "Input",ExpressionUUID->"d4b439d1-3025-445a-b813-70c3a1a31fac"],
Cell[2453, 77, 3936, 96, 456, "Input",ExpressionUUID->"ef9285c8-f0fe-4084-8436-be5ef5b5db9a"],
Cell[6392, 175, 3596, 89, 361, "Input",ExpressionUUID->"9f8ccbf2-1054-436d-88e1-6e25dcc84f26"],
Cell[9991, 266, 4097, 105, 557, "Input",ExpressionUUID->"cc03f918-925f-44d8-ac27-e2bd2db64ae1"],
Cell[14091, 373, 3956, 98, 549, "Input",ExpressionUUID->"48d6df21-6396-418a-b09d-92aaac805025"],
Cell[18050, 473, 229, 5, 55, "Input",ExpressionUUID->"6af13940-b0a6-4936-8bf0-28b4d9740bc2"],
Cell[CellGroupData[{
Cell[18304, 482, 91, 0, 55, "Subsection",ExpressionUUID->"b9775285-c665-44a4-81e1-977877a19850"],
Cell[18398, 484, 957, 27, 112, "Input",ExpressionUUID->"daa206ef-25a2-46ac-beab-7d86b0c1ef90"]
}, Open  ]],
Cell[CellGroupData[{
Cell[19392, 516, 87, 0, 55, "Subsection",ExpressionUUID->"a05a0e13-c90d-480e-9b93-a46ea8101056"],
Cell[19482, 518, 992, 29, 136, "Input",ExpressionUUID->"a5f123ff-c9e6-4486-84bc-631bd5f8800c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[20511, 552, 85, 0, 55, "Subsection",ExpressionUUID->"e6df1fcf-a2fb-48a4-8ce8-ae02881bcbcd"],
Cell[20599, 554, 964, 28, 112, "Input",ExpressionUUID->"d4ff27a7-a8d5-45b7-aec7-03e6670166f2"]
}, Open  ]],
Cell[CellGroupData[{
Cell[21600, 587, 99, 0, 55, "Subsection",ExpressionUUID->"bf99d4e9-49e3-4c61-b27f-f5a161401b96"],
Cell[21702, 589, 933, 28, 89, "Input",ExpressionUUID->"5cd65691-b708-4091-b190-fc374cae2bdc"]
}, Open  ]],
Cell[CellGroupData[{
Cell[22672, 622, 84, 0, 55, "Subsection",ExpressionUUID->"135fbf05-4a32-4138-ad65-a115c57be413"],
Cell[22759, 624, 1144, 31, 141, "Input",ExpressionUUID->"33f20699-f100-473c-9fda-32e6812ef8aa"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[23952, 661, 96, 0, 68, "Section",ExpressionUUID->"c72d01ec-8d97-4f81-889d-d6d6ad21a21c"],
Cell[24051, 663, 4044, 97, 499, "Input",ExpressionUUID->"b582dfcb-ab6f-4a80-8b7f-9e878c92b872"],
Cell[28098, 762, 3704, 90, 400, "Input",ExpressionUUID->"716c64a2-8855-4bbc-8dc6-e55938fe9d78"],
Cell[31805, 854, 4202, 106, 557, "Input",ExpressionUUID->"40ca40a5-af56-4cfa-afcc-dcd4df50cb3d"],
Cell[36010, 962, 4063, 99, 495, "Input",ExpressionUUID->"7d3fac15-3fef-43f6-b1bc-08e589d4a907"],
Cell[40076, 1063, 987, 27, 97, "Input",ExpressionUUID->"aa791100-5a57-46a7-8cf5-bdf8c182b35b"],
Cell[CellGroupData[{
Cell[41088, 1094, 91, 0, 54, "Subsection",ExpressionUUID->"aa9aebb4-9e16-4661-8b38-c3adf7a6fa92"],
Cell[41182, 1096, 1003, 29, 49, "Input",ExpressionUUID->"24ab5b96-9475-4e14-985e-e18d9f3938bd"]
}, Open  ]],
Cell[CellGroupData[{
Cell[42222, 1130, 87, 0, 54, "Subsection",ExpressionUUID->"1d4992d6-2e37-48ae-9485-7703725dae9e"],
Cell[42312, 1132, 1026, 30, 78, "Input",ExpressionUUID->"6ba67188-8879-44c6-a32e-bd7907ac768f"]
}, Open  ]],
Cell[CellGroupData[{
Cell[43375, 1167, 85, 0, 54, "Subsection",ExpressionUUID->"d7069e78-421c-4109-8830-e4f74b32eb6c"],
Cell[43463, 1169, 997, 29, 49, "Input",ExpressionUUID->"4e144856-a1e8-48f2-b5a4-feb44f52b242"]
}, Open  ]],
Cell[CellGroupData[{
Cell[44497, 1203, 99, 0, 54, "Subsection",ExpressionUUID->"6959d6de-1f79-4253-b803-c28e73d6b735"],
Cell[44599, 1205, 965, 29, 49, "Input",ExpressionUUID->"cc8ec308-3d27-4d32-b8fc-200974cb0cf3"]
}, Open  ]],
Cell[CellGroupData[{
Cell[45601, 1239, 84, 0, 54, "Subsection",ExpressionUUID->"f51f61b4-155a-4e2f-a231-18bfab7bb178"],
Cell[45688, 1241, 1144, 31, 103, "Input",ExpressionUUID->"fabb2ee1-1437-49bc-a1b5-c7bddef54cdd"],
Cell[46835, 1274, 204, 3, 35, "Text",ExpressionUUID->"85e35ab9-5a17-43d4-8934-52f1354ad800"]
}, Open  ]]
}, Open  ]]
}
]
*)

